/*!
****************************************************************************************************
* 文件名称：drvmanager-led.c
* 功能简介：该文件是驱动管理器CPU驱动模块的实现文件
* 文件作者：HQHP
* 创建日期：2020-08-21
* 版权声明：All Rights Reserved.
****************************************************************************************************
*/
#include "drvmanager.h"
#include "stm32f4xx.h"

/*!
****************************************************************************************************
* 常量定义
****************************************************************************************************
*/

/*!
****************************************************************************************************
* 类型定义
****************************************************************************************************
*/

/*!
****************************************************************************************************
* 全局变量
****************************************************************************************************
*/

/*!
****************************************************************************************************
* 本地声明
****************************************************************************************************
*/
static void DRVMGR_CPUInitPins(void);
unsigned char WDI_Flip_Flag;
/*!
****************************************************************************************************
* 接口函数
****************************************************************************************************
*/
/*!
****************************************************************************************************
* 功能描述：该方法用于初始化CPU驱动模块
* 注意事项：在调用该模块其他API前，必须先调用该模块
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DRVMGR_CPUInit(void)
{
	DRVMGR_CPUInitPins();
}

/*!
****************************************************************************************************
* 功能描述：该方法用于处理CPU驱动模块中需要周期处理的事务
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DRVMGR_CPUHandle(void)
{
	/* NOTHING TO DO */
}

/*!
****************************************************************************************************
* 功能描述：该方法用于执行CPU系统复位
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DRVMGR_CPUReset(void)
{
	__disable_irq();
	NVIC_SystemReset();
}

/*!
****************************************************************************************************
* 本地函数
****************************************************************************************************
*/
/*!
****************************************************************************************************
* 功能描述：NA
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
static void DRVMGR_CPUInitPins(void)
{
	GPIO_InitTypeDef GPIO_InitStructure;

	// WDI --> PC0
	GPIO_InitStructure.GPIO_Pin	  = GPIO_Pin_0;
	GPIO_InitStructure.GPIO_Mode  = GPIO_Mode_OUT;
	GPIO_InitStructure.GPIO_PuPd  = GPIO_PuPd_UP;
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_25MHz;
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOC, ENABLE);
	GPIO_Init(GPIOC, &GPIO_InitStructure);
	FEED();
}
void FEED(void)
{
//	if(WDI_Flip_Flag)
//	{
//	  GPIO_SetBits(GPIOC, GPIO_Pin_0);
//	}
//	else
//	{
//	  GPIO_ResetBits(GPIOC, GPIO_Pin_0);
//	}
//	WDI_Flip_Flag=(~WDI_Flip_Flag)&0x1;
	GPIO_ToggleBits(GPIOC, GPIO_Pin_0);

}
